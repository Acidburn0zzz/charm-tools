#!/bin/sh
set -e

usage()
{
    echo "usage: getall path_to_formulas" >&2
    exit $1
}

if [ -z "$1" ] ; then
    usage 1
fi
formula_home=$1

if [ "$1" = "--help" -o "$1" = "-h" ] ; then
    usage 0
fi

home=`dirname $0`
home=`readlink -f $home`

if ! [ -d "$formula_home/.bzr" ] ; then
  echo initializing $formula_home as bzr repository
  bzr init-repo $formula_home
  $home/update $formula_home
  echo checking out all formulas
  mr -c $formula_home/.mrconfig -d $formula_home --trust-all checkout
  echo "In order to update formulas, run this script again."
else
  mr -c $formula_home/.mrconfig -d $formula_home --trust-all update
fi
